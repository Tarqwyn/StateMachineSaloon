var fs = require('fs'),
model = require('model');
 
function CheckShortHandDirectory() {

	/*------------------------------------------------------------------
		Variables
	------------------------------------------------------------------*/
	var $ = model.$, el;

	/*------------------------------------------------------------------
		Methods
	------------------------------------------------------------------*/
	function sanityCheckDirectoryandContents(folderPath) {
		// Things to check
		// * is there an index.html file in the root
		// * check that there is a js file with the string 'story' in its file name at /static/build/js/

		// If these conditions are met then you can be reasonably sure that the folder supplied by the user is a genuine shorthand output folder
		if (doesIndexFileExist(folderPath + "/index.html") && doesStoryJsfileExist(folderPath + "/static/build/js")) {
			//looks like everything is correct and present!
			model.inputFolderPath = folderPath;
			model.stateMachine.publishStateChange(model.appStates.CHOOSE_OUTPUT_DIRECTORY);
		}
		else {
			//oh oh!
			var errorMessage = "I can't find the correct shorthand files in the directory that you have provided";
			model.stateMachine.publishStateChange(model.appStates.ERROR_STATE, errorMessage);
		}

	}
	this.sanityCheckDirectoryandContents = sanityCheckDirectoryandContents;

	function doesIndexFileExist(filePath) {
		return fs.existsSync(filePath);
	}
	this.doesIndexFileExist = doesIndexFileExist;

	function doesStoryJsfileExist(folderPath) {
		var filesArr = (fs.existsSync(folderPath)) ? fs.readdirSync(folderPath) : null;
		if (!filesArr) {
			return false;
		}
		var a, arrLength = filesArr.length;
		for (a = 0; a < arrLength; a++) {
			if ((filesArr[a].indexOf("story.") + 1) && (filesArr[a].indexOf(".js") + 1)) {
				/*------------------------
					GET/SET PROJECT number
				-------------------------*/
				var projectNumber = filesArr[a];
				projectNumber = projectNumber.replace(/[\D]/g, '');
				model.projectNumber = projectNumber;
				return true;
			}
		}

		return false;
	}
	this.doesStoryJsfileExist = doesStoryJsfileExist;

	/*------------------------------------------------------------------
		UTILITIES
	------------------------------------------------------------------*/

}
 
module.exports = new CheckShortHandDirectory();