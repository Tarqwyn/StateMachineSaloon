<script type="text/javascript">
require(empConfig, ['bump-3'], function (bump) {
  var settings = {
        product: 'news',
        playerProfile: 'smp',
        responsive: true,
        counterName: istatsGlobal.getCountername()
      },
      smpVidsController = {},
      isMobileDevice = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
      videoElements = $('.ns_lf_video'),
      scrollDelayTimer;
  
  // autogenerated do not edit
  {{#mediaPlayersInit}}
  // end of autogenerated code

  var documentViewport = function () {
    var docViewTop = $(window).scrollTop(), 
        docViewBottom = docViewTop + $(window).height(), 
        docViewHeight = docViewBottom - docViewTop, 
        viewThreshold = docViewHeight * 0.4;
    
    return {
      'top': docViewTop, 
      'bottom': docViewBottom, 
      'height':docViewHeight, 
      'threshold': viewThreshold
    }
  };

  var isElementInView = function (elem) {
      var elemTop = elem.offset().top,
          elemBottom = elemTop + elem.height(),
          viewport = documentViewport();

      return (elemTop < (viewport.bottom - viewport.threshold)) && (elemBottom > (viewport.top + viewport.threshold));
  };

  var videoObjectForThisElement = function (elem) {
      var vidControllerObj = smpVidsController[elem.attr('id')],
          playerInstance = vidControllerObj.mp,
          currentTime = playerInstance.currentTime(),
          vidPaused = playerInstance.paused();

      return {
        'instance': playerInstance,
        'currentTime': currentTime,
        'autoPaused': vidControllerObj.autoPaused,
        'userPaused': vidControllerObj.userPaused,
        'paused': vidPaused
      }

  };

  if (isMobileDevice) {
    return;
  }

  // track the scroll event..
  $(window).on('scroll', function(e) {
    if (scrollDelayTimer) { clearTimeout(scrollDelayTimer); }
    scrollDelayTimer = setTimeout(function() {
      $(window).trigger('delayedEvent');
    }, 200);
  });

  $(window).on('delayedEvent', function() {
    videoElements.each(function () {
      var currentVideoObject = videoObjectForThisElement($(this)),
          videoElementInView = isElementInView($(this));

      if (!currentVideoObject.userPaused && !currentVideoObject.autoPaused && currentVideoObject.paused) {
        currentVideoObject.instance.userPaused = true;
      }
      if (currentVideoObject.userPaused && currentVideoObject.autoPaused && !currentVideoObject.paused) {
        currentVideoObject.instance.userPaused = false;
      }

      //user paused state
      if (videoElementInView && currentVideoObject.paused && !currentVideoObject.autoPaused) {
        currentVideoObject.instance.userPaused = true;
      }
      if (!currentVideoObject.paused) {
        currentVideoObject.instance.userPaused = false;
      }

      //auto paused state
      currentVideoObject.instance.autoPaused = !videoElementInView;

      // play or pause video
      // if (videoElementInView && !currentVideoObject.userPaused && !currentVideoObject.instance.ended()) {
      //  playerInstance.play();
      // }
      if (!videoElementInView) {
        currentVideoObject.instance.pause();
      }
    })
  });

});
</script>